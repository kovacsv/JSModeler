<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	 "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>

	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<script type="text/javascript" src="../build/three.min.js"></script>
<!-- JSModeler includes start -->
	<script type="text/javascript" src="../src/core/jsm.js"></script>
	<script type="text/javascript" src="../src/core/timer.js"></script>
	<script type="text/javascript" src="../src/geometry/determinant.js"></script>
	<script type="text/javascript" src="../src/geometry/matrix.js"></script>
	<script type="text/javascript" src="../src/geometry/coord.js"></script>
	<script type="text/javascript" src="../src/geometry/coordutils.js"></script>
	<script type="text/javascript" src="../src/geometry/coordsystem.js"></script>
	<script type="text/javascript" src="../src/geometry/coordsystemutils.js"></script>
	<script type="text/javascript" src="../src/geometry/sector.js"></script>
	<script type="text/javascript" src="../src/geometry/sectorutils.js"></script>
	<script type="text/javascript" src="../src/geometry/line.js"></script>
	<script type="text/javascript" src="../src/geometry/lineutils.js"></script>
	<script type="text/javascript" src="../src/geometry/transformation.js"></script>
	<script type="text/javascript" src="../src/geometry/transformationutils.js"></script>
	<script type="text/javascript" src="../src/geometry/plane.js"></script>
	<script type="text/javascript" src="../src/geometry/planeutils.js"></script>
	<script type="text/javascript" src="../src/geometry/projection.js"></script>
	<script type="text/javascript" src="../src/geometry/convexhull.js"></script>
	<script type="text/javascript" src="../src/geometry/polygon.js"></script>
	<script type="text/javascript" src="../src/geometry/polygonutils.js"></script>
	<script type="text/javascript" src="../src/geometry/bsptree.js"></script>
	<script type="text/javascript" src="../src/geometry/utilities.js"></script>
	<script type="text/javascript" src="../src/modeler/body.js"></script>
	<script type="text/javascript" src="../src/modeler/model.js"></script>
	<script type="text/javascript" src="../src/modeler/material.js"></script>
	<script type="text/javascript" src="../src/modeler/bodyutils.js"></script>
	<script type="text/javascript" src="../src/modeler/adjacencylist.js"></script>
	<script type="text/javascript" src="../src/modeler/textureutils.js"></script>
	<script type="text/javascript" src="../src/modeler/cututils.js"></script>
	<script type="text/javascript" src="../src/modeler/generator.js"></script>
	<script type="text/javascript" src="../src/modeler/camera.js"></script>
	<script type="text/javascript" src="../src/modeler/exporter.js"></script>
	<script type="text/javascript" src="../src/extras/solidgenerator.js"></script>
	<script type="text/javascript" src="../src/extras/extgenerator.js"></script>
	<script type="text/javascript" src="../src/extras/painter.js"></script>
	<script type="text/javascript" src="../src/extras/drawing.js"></script>
	<script type="text/javascript" src="../src/extras/subdivision.js"></script>
	<script type="text/javascript" src="../src/extras/svgtomodel.js"></script>
	<script type="text/javascript" src="../src/extras/csg.js"></script>
	<script type="text/javascript" src="../src/extras/surfaces.js"></script>
	<script type="text/javascript" src="../src/viewer/mouse.js"></script>
	<script type="text/javascript" src="../src/viewer/touch.js"></script>
	<script type="text/javascript" src="../src/viewer/converter.js"></script>
	<script type="text/javascript" src="../src/viewer/viewer.js"></script>
	<script type="text/javascript" src="../src/viewer/softwareviewer.js"></script>
<!-- JSModeler includes end -->
	<title>Example</title>

	<script type="text/javascript">
		var viewer = null;
		var body = null;
	
		function TheFunction (x, y)
		{
			var sq = Math.sqrt (x*x + y*y);
			return 4 * Math.sin (sq) / sq;
		};

		function Generate ()
		{
			var interval = 10;
			var intervalMin = new JSM.Coord2D (-interval, -interval);
			var intervalMax = new JSM.Coord2D (interval, interval);
			
			var segmentation = document.getElementById ('segmentation');
			body = JSM.GenerateFunctionSurfaceSolid (function (x, y) { return TheFunction (x, y); }, intervalMin, intervalMax, parseInt (segmentation.value), false, 3);

			var i, vertex;
			var scale = 1.5;
			for (i = 0; i < body.VertexCount (); i++) {
				vertex = body.GetVertex (i);
				vertex.position.x *= scale;
				vertex.position.y *= scale;
				vertex.position.z *= scale;
			}
			
			viewer.RemoveMeshes ();
			
			var meshes = JSM.ConvertBodyToThreeMeshes (body);
			for (i = 0; i < meshes.length; i++) {
				viewer.AddMesh (meshes[i]);
			}
		}
		
		function Load ()
		{
			function TextureLoaded () {
				viewer.Draw ();
			}
		
			var viewerSettings = {
				'cameraEyePosition' : [3.0, -3.0, 3.0],
				'cameraCenterPosition' : [0.0, 0.0, 0.0],
				'cameraUpVector' : [0.0, 0.0, 1.0],
				'fieldOfView' : 45.0,
				'nearClippingPlane' : 0.1,
				'farClippingPlane' : 1000.0,
				'lightAmbientColor' : [0.5, 0.5, 0.5],
				'lightDiffuseColor' :	[0.5, 0.5, 0.5]
			};

			viewer = new JSM.Viewer ();
			if (!viewer.Start ('example', viewerSettings)) {
				alert ('Viewer initialization failed.');
				return;
			}
			
			Generate ();
			
			viewer.FitInWindow ();
			viewer.Draw ();
		}
	
		function Export ()
		{
			var exportDiv = document.getElementById ('exported');
			exportDiv.value = JSM.ExportBodyToStl (body, 'model');
		}
	
	    window.onload = function ()
		{
			Load ();			
		}

	</script>

</head>

<body>
	<canvas id="example" width="800" height="500" style="border : 1px solid black;"></canvas>
	<br>
	segmentation: <input type="text" id="segmentation" value="50"></input><input type="button" value="generate" onclick="javascript:Generate ();"></input>
	<a href="javascript:Export ();">export to stl</a><br>
	<textarea rows="20" cols="100" id="exported"></textarea>
</body>

</html>
